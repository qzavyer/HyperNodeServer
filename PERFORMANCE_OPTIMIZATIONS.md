# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–≤–∏—Å–∞–ª–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–º–µ—Ä–æ–º 30+ –ì–ë:
- HTTP-—Å–µ—Ä–≤–µ—Ä –¥–æ–ª–≥–æ –Ω–µ –æ—Ç–≤–µ—á–∞–ª
- Telnet –∑–∞–≤–∏—Å–∞–ª –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ event loop –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

## –†–µ—à–µ–Ω–∏—è

### 1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–ë—ã–ª–æ:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å
```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop
with open(path, 'r') as f:
    for line in f:  # –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
        process_line(line)
```

**–°—Ç–∞–ª–æ:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ø–æ —á–∞—Å—Ç—è–º
```python
# –ù–æ–≤—ã–π –∫–æ–¥ - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
async with aiofiles.open(path, 'r') as f:
    while True:
        chunk = await f.read(chunk_size)  # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        if not chunk:
            break
        process_chunk(chunk)
```

### 2. –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤

**–ë—ã–ª–æ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É –æ—Ä–¥–µ—Ä—É
```python
for order in orders:
    await order_manager.update_order(order)  # –ú–Ω–æ–≥–æ I/O –æ–ø–µ—Ä–∞—Ü–∏–π
```

**–°—Ç–∞–ª–æ:** –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–ø–ø–∞–º–∏ –ø–æ 1000 –æ—Ä–¥–µ—Ä–æ–≤
for i in range(0, len(orders), batch_size):
    batch = orders[i:i + batch_size]
    await order_manager.update_orders_batch_async(batch)
    await asyncio.sleep(0.01)  # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞
```

### 3. –¢–∞–π–º–∞—É—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω—ã:**
- –¢–∞–π–º–∞—É—Ç –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–∞: 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ì–ë
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 50 –ì–ë
- –ú–∞–∫—Å–∏–º—É–º –æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ —Ñ–∞–π–ª: 1,000,000
- –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è: 8KB

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ë—ã–ª–æ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
```python
await self.storage.save_orders_async(list(self.orders.values()))
```

**–°—Ç–∞–ª–æ:** –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –±–∞—Ç—á–∏–Ω–≥–æ–º
```python
async def _schedule_save_async(self):
    if self._save_pending:
        return
    self._save_pending = True
    await asyncio.sleep(0.1)  # –°–æ–±–∏—Ä–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    await self.storage.save_orders_async(list(self.orders.values()))
```

### 5. Middleware –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–î–æ–±–∞–≤–ª–µ–Ω—ã:**
- `TimeoutMiddleware` - —Ç–∞–π–º–∞—É—Ç 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- `PerformanceMiddleware` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Endpoint `/performance` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# .env —Ñ–∞–π–ª
MAX_FILE_SIZE_GB=50.0
MAX_ORDERS_PER_FILE=1000000
CHUNK_SIZE_BYTES=8192
BATCH_SIZE=1000
PROCESSING_TIMEOUT_PER_GB=5
```

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (50+ –ì–ë):**
```bash
MAX_FILE_SIZE_GB=100.0
CHUNK_SIZE_BYTES=16384
BATCH_SIZE=2000
PROCESSING_TIMEOUT_PER_GB=3
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å:**
```bash
MAX_FILE_SIZE_GB=20.0
MAX_ORDERS_PER_FILE=500000
BATCH_SIZE=500
PROCESSING_TIMEOUT_PER_GB=10
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
curl http://localhost:8000/performance

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
curl http://localhost:8000/health

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python scripts/performance_test.py
```

### –õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –§–∞–π–ª—ã —Ä–∞–∑–º–µ—Ä–æ–º > 1 –ì–ë
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (> 1 —Å–µ–∫—É–Ω–¥—ã)
- –¢–∞–π–º–∞—É—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚ùå –§–∞–π–ª—ã 30 –ì–ë –≤—ã–∑—ã–≤–∞–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–µ
- ‚ùå HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–ª
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ event loop
- ‚ùå –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 50 –ì–ë
- ‚úÖ HTTP-—Å–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ RAM
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤** - –ø–æ–¥ –≤–∞—à–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π** - —É–≤–µ–ª–∏—á—å—Ç–µ –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ INFO —É—Ä–æ–≤–µ–Ω—å

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

1. –£–º–µ–Ω—å—à–∏—Ç–µ `BATCH_SIZE`
2. –£–≤–µ–ª–∏—á—å—Ç–µ `PROCESSING_TIMEOUT_PER_GB`
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ `MAX_FILE_SIZE_GB`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/performance` endpoint

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```bash
python scripts/performance_test.py
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç:
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ endpoints
- –û–±—Ä–∞–±–æ—Ç–∫—É concurrent –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
