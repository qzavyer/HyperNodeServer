# Задание для ИИ-агента: Настройка Parser подключения к NATS

## Контекст
Вы работаете с системой HyperLiquid Node Parser, которая состоит из двух компонентов:
- **Parser** - парсит логи и извлекает данные об ордерах
- **Processor** - обрабатывает данные от Parser'а и выполняет анализ

NATS сервер уже настроен и работает с аутентификацией через JWT.

## Задание
Настройте подключение **Parser** к NATS серверу для отправки данных в Processor.

## Требования

### 1. Архитектура подключения
- **Parser** должен подключаться к NATS серверу по адресу `nats://localhost:4222`
- Использовать аутентификацию через JWT файл `parser.creds`
- Публиковать данные в топик `parser_data.>` для отправки в Processor
- Подписываться на конфигурационные сообщения из топика `parser_config.>`

### 2. Технические требования
- **Язык**: Python 3.8+
- **Библиотека**: `nats-py` для подключения к NATS
- **Асинхронность**: Использовать `asyncio` для асинхронной работы
- **Обработка ошибок**: Корректная обработка ошибок подключения и аутентификации
- **Логирование**: Подробное логирование всех операций

### 3. Функциональность
- **Подключение к NATS**: Установка соединения с аутентификацией
- **Публикация данных**: Отправка данных в топик `parser_data.>`
- **Подписка на конфиги**: Получение конфигурационных сообщений из `parser_config.>`
- **Мониторинг**: Отслеживание состояния подключения и обработки

### 4. Публикация данных
- На вход принимает `models.Order`
- Форматировать данные для отправки в NATS
- Отправку данных сделать параллельно с Websocket

### 5. Формат данных
```json
{
    "id": "12345",
    "symbol": "BTC",
    "side": "bid/ask",
    "price": 50000.0,
    "size": 1.5,
    "owner": "0x123...",
    "timestamp": "2024-01-01T12:00:00Z",
    "status": "open",
    "source": "parser"
}
```

### 6. Конфигурация
- **NATS URL**: `nats://localhost:4222`
- **JWT файл**: `creds/parser.creds`
- **Топик данных**: `parser_data.>`
- **Топик конфигов**: `parser_config.>`
- **Лог файл**: `logs/parser.log`
- **Директория логов**: `data/sample_logs/`

### 7. Обработка ошибок
- Переподключение при разрыве соединения
- Обработка ошибок аутентификации
- Валидация входящих данных
- Обработка ошибок парсинга логов
- Логирование всех ошибок

## Ожидаемый результат
1. **Рабочий Parser** - подключается к NATS и парсит логи
2. **Корректная аутентификация** - использует JWT файл для подключения
3. **Парсинг логов** - читает и анализирует лог файлы
4. **Публикация данных** - отправляет данные в Processor
5. **Логирование** - все операции записываются в лог файл

## Тестирование
- Запустить Parser
- Проверить подключение к NATS
- Поместить тестовый лог файл в `data/sample_logs/`
- Убедиться, что Parser парсит и отправляет данные
- Проверить логи на наличие ошибок

## Дополнительные требования
- Следовать принципам KISS (Keep It Simple, Stupid)
- Использовать TDD подход (сначала тесты, потом код)
- Документировать все публичные методы
- Соблюдать правила именования из conventions.md
- Обеспечить асинхронную работу для высокой производительности

Начните с создания базовой структуры и постепенно добавляйте функциональность.
